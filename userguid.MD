# ğŸ¯ å¤šæ–‡ä»¶æµ‹è¯•ä½¿ç”¨æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è§ˆ

æµ‹è¯•æ¡†æ¶ç°åœ¨æ”¯æŒï¼š
- âœ… è¿è¡Œå•ä¸ª YAML æ–‡ä»¶
- âœ… è¿è¡Œç›®å½•ä¸­çš„æ‰€æœ‰ YAML æ–‡ä»¶
- âœ… é€’å½’æœç´¢å­ç›®å½•
- âœ… è‡ªå®šä¹‰æ–‡ä»¶åŒ¹é…æ¨¡å¼
- âœ… æ±‡æ€»æ‰€æœ‰æµ‹è¯•ç»“æœ
- âœ… åˆ†åˆ«å¯¼å‡ºæ¯ä¸ªæ–‡ä»¶çš„ç»“æœ

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. è¿è¡Œå•ä¸ªæ–‡ä»¶

```bash
go run cmd/apitest/main.go \
  -config testcases/user_api_test.yaml
```

### 2. è¿è¡Œç›®å½•ä¸­çš„æ‰€æœ‰ YAML æ–‡ä»¶

```bash
go run cmd/apitest/main.go \
  -config testcases/
```

### 3. é€’å½’æœç´¢å­ç›®å½•

```bash
# é»˜è®¤å¼€å¯é€’å½’æœç´¢
go run cmd/apitest/main.go \
  -config testcases/ \
  -recursive=true
```

### 4. ä½¿ç”¨è‡ªå®šä¹‰æ–‡ä»¶æ¨¡å¼

```bash
# åªè¿è¡Œä»¥ _test.yaml ç»“å°¾çš„æ–‡ä»¶
go run cmd/apitest/main.go \
  -config testcases/ \
  -pattern "*_test.yaml"

# åªè¿è¡Œä»¥ api_ å¼€å¤´çš„æ–‡ä»¶
go run cmd/apitest/main.go \
  -config testcases/ \
  -pattern "api_*.yaml"

# è¿è¡Œç‰¹å®šæ¨¡å—çš„æµ‹è¯•
go run cmd/apitest/main.go \
  -config testcases/ \
  -pattern "user_*.yaml"
```

### 5. å®Œæ•´ç¤ºä¾‹ï¼ˆå¸¦æ‰€æœ‰é€‰é¡¹ï¼‰

```bash
go run cmd/apitest/main.go \
  -config testcases/ \
  -pattern "*_api_test.yaml" \
  -recursive=true \
  -db "user:pass@tcp(localhost:3306)/testdb?charset=utf8mb4&parseTime=True" \
  -url http://test-server:8080 \
  -export test_results/
```

## ğŸ“‚ æ¨èç›®å½•ç»“æ„

```
project/
â”œâ”€â”€ testcases/
â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”œâ”€â”€ user_api_test.yaml          # ç”¨æˆ· API æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ user_auth_test.yaml         # ç”¨æˆ·è®¤è¯æµ‹è¯•
â”‚   â”‚   â””â”€â”€ user_permission_test.yaml   # ç”¨æˆ·æƒé™æµ‹è¯•
â”‚   â”œâ”€â”€ product/
â”‚   â”‚   â”œâ”€â”€ product_crud_test.yaml      # äº§å“ CRUD æµ‹è¯•
â”‚   â”‚   â””â”€â”€ product_search_test.yaml    # äº§å“æœç´¢æµ‹è¯•
â”‚   â”œâ”€â”€ order/
â”‚   â”‚   â”œâ”€â”€ order_create_test.yaml      # è®¢å•åˆ›å»ºæµ‹è¯•
â”‚   â”‚   â””â”€â”€ order_payment_test.yaml     # è®¢å•æ”¯ä»˜æµ‹è¯•
â”‚   â””â”€â”€ integration/
â”‚       â””â”€â”€ full_flow_test.yaml         # å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
â””â”€â”€ test_results/
    â”œâ”€â”€ user_api_test_results.json
    â”œâ”€â”€ user_auth_test_results.json
    â””â”€â”€ ...
```

## ğŸ¯ å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `-config` | string | **å¿…å¡«** | æµ‹è¯•é…ç½®æ–‡ä»¶æˆ–ç›®å½•è·¯å¾„ |
| `-pattern` | string | `*.yaml` | æ–‡ä»¶åŒ¹é…æ¨¡å¼ |
| `-recursive` | bool | `true` | æ˜¯å¦é€’å½’æœç´¢å­ç›®å½• |
| `-db` | string | `""` | æ•°æ®åº“ DSNï¼ˆç”¨äºæ•°æ®æ¸…ç†ï¼‰ |
| `-url` | string | `http://localhost:8080` | API åŸºç¡€ URL |
| `-export` | string | `""` | å¯¼å‡ºç»“æœçš„ç›®å½•è·¯å¾„ |

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### è¿è¡Œå¤šä¸ªæ–‡ä»¶æ—¶çš„è¾“å‡º

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ§ª API Integration Test Runner
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Config Path: testcases/
ğŸ” Pattern: *.yaml
ğŸ—„ï¸  Database: Connected (cleanup enabled)
ğŸ“‹ Found 5 test file(s):
   1. testcases/user/user_api_test.yaml
   2. testcases/user/user_auth_test.yaml
   3. testcases/product/product_crud_test.yaml
   4. testcases/order/order_create_test.yaml
   5. testcases/integration/full_flow_test.yaml
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ“„ Running: user_api_test.yaml                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ Running test suite: User API Tests
ğŸ“ Base URL: http://localhost:8080

ğŸ”§ Executing setup...
  âœ“ Soft deleted 0 rows from table 't_user'
âœ“ Setup completed

ğŸ“¦ Scenario: User Lifecycle
   æµ‹è¯•ç”¨æˆ·çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œéµå¾ªå¹‚ç­‰æ€§è®¾è®¡
   âœ“ Lifecycle - Create User (0.12s)
   âœ“ Lifecycle - Get User After Create (0.05s)
   âœ“ Lifecycle - Update User (0.08s)
   âœ“ Lifecycle - Delete User (0.06s)

ğŸ“¦ Scenario: Parameter Validation
   æµ‹è¯•è¯·æ±‚å‚æ•°éªŒè¯
   âœ“ Create User - Missing Required Field (0.04s)
   âœ“ Create User - Unknown Field (0.04s)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š Test Summary
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Total Tests:     6
âœ“ Passed:        6
âœ— Failed:        0
â±  Duration:      0.39s
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‰ All tests passed!


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ ğŸ“„ Running: user_auth_test.yaml                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

... (ç±»ä¼¼è¾“å‡º)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                  ğŸ“Š OVERALL SUMMARY                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ Test Files: 5
âœ… Total Passed: 45
âŒ Total Failed: 2
ğŸ“ˆ Success Rate: 95.74%

âŒ Failed Tests by File:

  ğŸ“„ product_crud_test.yaml (2 failed)
     âœ— [Product Management] Create Product with Invalid Price
       assertion failed: data.error should contain "invalid price"
     âœ— [Product Management] Delete Non-existent Product
       status code mismatch: expected 404, got 500

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“„ Test results exported to: test_results/
  âœ“ Exported: test_results/user_api_test_results.json
  âœ“ Exported: test_results/user_auth_test_results.json
  âœ“ Exported: test_results/product_crud_test_results.json
  âœ“ Exported: test_results/order_create_test_results.json
  âœ“ Exported: test_results/full_flow_test_results.json
```

## ğŸ¨ å®ç”¨åœºæ™¯

### åœºæ™¯ 1: å¼€å‘æ—¶åªæµ‹è¯•å½“å‰æ¨¡å—

```bash
# åªæµ‹è¯•ç”¨æˆ·ç›¸å…³ API
go run cmd/apitest/main.go \
  -config testcases/user/ \
  -recursive=false
```

### åœºæ™¯ 2: CI/CD å®Œæ•´å›å½’æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œå¯¼å‡ºç»“æœ
go run cmd/apitest/main.go \
  -config testcases/ \
  -db "${DB_DSN}" \
  -url "${API_URL}" \
  -export ci_results/ \
  -pattern "*_test.yaml"
```

### åœºæ™¯ 3: æŒ‰ä¼˜å…ˆçº§è¿è¡Œæµ‹è¯•

```yaml
# ç›®å½•ç»“æ„
testcases/
â”œâ”€â”€ p0_critical/      # P0 æ ¸å¿ƒåŠŸèƒ½
â”œâ”€â”€ p1_important/     # P1 é‡è¦åŠŸèƒ½
â””â”€â”€ p2_normal/        # P2 æ™®é€šåŠŸèƒ½
```

```bash
# å…ˆè¿è¡Œ P0 æµ‹è¯•
go run cmd/apitest/main.go -config testcases/p0_critical/

# å¦‚æœ P0 é€šè¿‡ï¼Œå†è¿è¡Œ P1
go run cmd/apitest/main.go -config testcases/p1_important/
```

### åœºæ™¯ 4: æŒ‰æ¨¡å—åˆ†åˆ«æµ‹è¯•

```bash
# æµ‹è¯•ç”¨æˆ·æ¨¡å—
go run cmd/apitest/main.go \
  -config testcases/ \
  -pattern "user_*.yaml" \
  -export results/user/

# æµ‹è¯•äº§å“æ¨¡å—
go run cmd/apitest/main.go \
  -config testcases/ \
  -pattern "product_*.yaml" \
  -export results/product/

# æµ‹è¯•è®¢å•æ¨¡å—
go run cmd/apitest/main.go \
  -config testcases/ \
  -pattern "order_*.yaml" \
  -export results/order/
```

## ğŸ”§ æœ€ä½³å®è·µ

### 1. æ–‡ä»¶å‘½åè§„èŒƒ

```
âœ… æ¨è:
- user_api_test.yaml
- product_crud_test.yaml
- order_payment_test.yaml

âŒ é¿å…:
- test.yaml (å¤ªé€šç”¨)
- t1.yaml (æ— æ„ä¹‰)
- api.yaml (ä¸æ˜ç¡®)
```

### 2. ç›®å½•ç»„ç»‡

```
âœ… æŒ‰æ¨¡å—ç»„ç»‡:
testcases/
â”œâ”€â”€ user/
â”œâ”€â”€ product/
â””â”€â”€ order/

âœ… æŒ‰ä¼˜å…ˆçº§ç»„ç»‡:
testcases/
â”œâ”€â”€ p0_critical/
â”œâ”€â”€ p1_important/
â””â”€â”€ p2_normal/

âœ… æ··åˆç»„ç»‡:
testcases/
â”œâ”€â”€ smoke/          # å†’çƒŸæµ‹è¯•
â”œâ”€â”€ regression/     # å›å½’æµ‹è¯•
â””â”€â”€ modules/
    â”œâ”€â”€ user/
    â””â”€â”€ product/
```

### 3. æ•°æ®éš”ç¦»

æ¯ä¸ªæµ‹è¯•æ–‡ä»¶åº”è¯¥ï¼š
- ä½¿ç”¨å”¯ä¸€çš„æµ‹è¯•æ•°æ®å‰ç¼€
- åœ¨ setup ä¸­æ¸…ç†æ—§æ•°æ®
- åœ¨ teardown ä¸­æ¸…ç†æ–°æ•°æ®

```yaml
# user_api_test.yaml
suite:
  setup:
    - type: soft_delete_cleanup
      table: t_user
      condition: "username LIKE 'test-user-%'"

# product_api_test.yaml
suite:
  setup:
    - type: soft_delete_cleanup
      table: t_product
      condition: "name LIKE 'test-product-%'"
```

## ğŸ“ˆ CI/CD é›†æˆ

### GitHub Actions

```yaml
name: API Tests

on: [push, pull_request]

jobs:
  api-test:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      
      - name: Start Services
        run: docker-compose up -d
      
      - name: Wait for Services
        run: sleep 10
      
      - name: Run P0 Tests
        run: |
          go run cmd/apitest/main.go \
            -config testcases/p0_critical/ \
            -db "${{ secrets.TEST_DB_DSN }}" \
            -export test_results/p0/
      
      - name: Run All Tests
        if: success()
        run: |
          go run cmd/apitest/main.go \
            -config testcases/ \
            -pattern "*_test.yaml" \
            -db "${{ secrets.TEST_DB_DSN }}" \
            -export test_results/all/
      
      - name: Upload Results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: test-results
          path: test_results/
```

### Jenkins Pipeline

```groovy
pipeline {
    agent any
    
    stages {
        stage('Setup') {
            steps {
                sh 'docker-compose up -d'
                sh 'sleep 10'
            }
        }
        
        stage('Run Tests') {
            steps {
                sh '''
                    go run cmd/apitest/main.go \
                        -config testcases/ \
                        -pattern "*_test.yaml" \
                        -db "${TEST_DB_DSN}" \
                        -export test_results/
                '''
            }
        }
    }
    
    post {
        always {
            archiveArtifacts artifacts: 'test_results/**/*.json'
            sh 'docker-compose down'
        }
    }
}
```

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜ 1: æ‰¾ä¸åˆ°æµ‹è¯•æ–‡ä»¶

```bash
âŒ No test configuration files found in: testcases/
```

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åŒ¹é… pattern
3. ä½¿ç”¨ `-pattern "*.yml"` å¦‚æœæ–‡ä»¶æ˜¯ `.yml` æ‰©å±•å

### é—®é¢˜ 2: æŸä¸ªæ–‡ä»¶è§£æå¤±è´¥

```bash
âŒ Failed to load test configuration: failed to parse config
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ YAML è¯­æ³•
- ä½¿ç”¨ `yamllint` éªŒè¯æ–‡ä»¶
- å•ç‹¬è¿è¡Œè¯¥æ–‡ä»¶å®šä½é—®é¢˜

### é—®é¢˜ 3: æ•°æ®åº“æ¸…ç†å†²çª

å¤šä¸ªæµ‹è¯•æ–‡ä»¶åŒæ—¶æ¸…ç†ç›¸åŒçš„è¡¨å¯èƒ½å¯¼è‡´å†²çªã€‚

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ä¸åŒçš„æ•°æ®å‰ç¼€
- åœ¨ setup ä¸­æ·»åŠ æ›´ç²¾ç¡®çš„æ¡ä»¶
- è€ƒè™‘ä½¿ç”¨äº‹åŠ¡éš”ç¦»ï¼ˆå¦‚æœæ”¯æŒï¼‰

## âœ¨ æ€»ç»“

ç°åœ¨ä½ å¯ä»¥ï¼š
- âœ… è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
- âœ… æ‰¹é‡è¿è¡Œå¤šä¸ªæµ‹è¯•æ–‡ä»¶
- âœ… æŒ‰æ¨¡å—/ä¼˜å…ˆçº§ç»„ç»‡æµ‹è¯•
- âœ… è‡ªå®šä¹‰æ–‡ä»¶åŒ¹é…æ¨¡å¼
- âœ… è·å–æ±‡æ€»æµ‹è¯•æŠ¥å‘Š
- âœ… è½»æ¾é›†æˆåˆ° CI/CD æµç¨‹

æµ‹è¯•æ›´çµæ´»ï¼Œç»´æŠ¤æ›´ç®€å•ï¼ğŸ‰